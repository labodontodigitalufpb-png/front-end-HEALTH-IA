<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Health IA UFPB</title>

  <style>
    :root{
      --bg1:#061a2e;
      --bg2:#0b2b4a;
      --card:#0f3b66cc;
      --card2:#0b2f53cc;
      --text:#eaf4ff;
      --muted:#b9d7f3;
      --accent:#33b4ff;
      --accent2:#0ea5e9;
      --danger:#ff4d4d;
      --ok:#41d17d;
      --border:#3a76a8;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(900px 450px at 15% 10%, #0d4b78 0%, transparent 60%),
        radial-gradient(900px 450px at 85% 20%, #0a6bb0 0%, transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .app{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1fr;
      gap:18px;
    }

    .panel{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
      border-radius:18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      padding:18px;
      position:relative;
      overflow:hidden;
    }

    header{
      display:flex;
      align-items:center;
      gap:14px;
      margin-bottom:14px;
    }

    .logo{
      width:140px;
      height:140px;
      border-radius:22px;
      object-fit:contain;
      background:#fff;
      padding:10px;
      border:1px solid rgba(255,255,255,.25);
      box-shadow: 0 4px 12px rgba(0,0,0,.25);
      flex: 0 0 auto;
    }

    h1{
      font-size: 26px;
      margin:0;
      line-height:1.1;
    }

    .subtitle{
      margin-top:6px;
      font-size: 13.5px;
      color: var(--muted);
    }

    .badges{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:8px;
    }

    .badge{
      font-size:12px;
      background: rgba(51,180,255,.12);
      border: 1px solid rgba(51,180,255,.25);
      padding:6px 10px;
      border-radius:999px;
    }

    label{
      font-size: 13px;
      color: var(--muted);
      margin: 12px 0 8px;
      display:block;
    }

    textarea, input{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(185,215,243,.25);
      background: rgba(3, 17, 32, .35);
      color: var(--text);
      padding: 12px;
      font-size: 14px;
    }

    textarea{
      min-height: 120px;
      resize: vertical;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
      align-items:center;
    }

    .btn{
      border:none;
      border-radius: 12px;
      padding: 12px 14px;
      font-weight: 650;
      cursor:pointer;
      color: #06203a;
      background: linear-gradient(180deg, #59c7ff, var(--accent2));
      box-shadow: 0 12px 24px rgba(14,165,233,.25);
    }

    .btn-ghost{
      background: rgba(255,255,255,.08);
      color: var(--text);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:none;
    }

    .status{
      font-size: 12.5px;
      margin-top: 10px;
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
    }

    .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(185,215,243,.55);
    }
    .dot.ok{ background: var(--ok); }
    .dot.err{ background: var(--danger); }
    .dot.busy{ background: #ffd166; }

    .resultBox{
      margin-top: 10px;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(51,180,255,.25);
      background: rgba(2, 20, 38, .38);
      min-height: 150px;
      white-space: pre-wrap;
    }

    footer{
      margin-top: 12px;
      font-size: 12px;
      color: rgba(185,215,243,.8);
    }

    @media (max-width: 880px){
      h1{ font-size: 22px; }
      .logo{ width: 110px; height: 110px; }
    }

    @media (max-width: 520px){
      header{
        flex-direction: column;
        align-items: flex-start;
      }
      .logo{
        width: 96px;
        height: 96px;
      }
      .row{
        flex-direction: column;
        align-items: stretch;
      }
      .btn{
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <main class="app">
    <section class="panel">
      <header>
        <img class="logo" src="./logo.jpg" alt="Logo LABODIGIT / UFPB" />
        <div>
          <h1>Health IA UFPB</h1>
          <div class="subtitle">Diagnóstico baseado nos sintomas</div>
          <div class="badges">
            <div class="badge">Modelo: <b>XGBoost</b> • Acurácia: <b>83,67%</b></div>
            <div class="badge">API: <span id="apiBadge">https://healthiaufpb.onrender.com</span></div>
          </div>
        </div>
      </header>

      <label for="apiBase">URL da API</label>
      <input id="apiBase" type="text" value="https://healthiaufpb.onrender.com" />

      <label for="sintomas">Sintomas</label>
      <textarea id="sintomas" placeholder="Ex.: febre, tosse, cansaço"></textarea>

      <div class="row">
        <button id="btnDiagnosticar" class="btn">Gerar diagnóstico provável</button>
        <button id="btnExemplo" class="btn btn-ghost" type="button">Preencher exemplo</button>
        <button id="btnLimpar" class="btn btn-ghost" type="button">Limpar</button>
      </div>

      <div class="status" id="statusLine">
        <span class="dot" id="statusDot"></span>
        <span id="statusText">Pronto.</span>
      </div>

      <label>Diagnóstico provável</label>
      <div class="resultBox" id="resultado">—</div>

      <footer>
        UFPB • LABODIGIT • Health IA
      </footer>
    </section>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);

    const apiBase = $("apiBase");
    const apiBadge = $("apiBadge");
    const sintomas = $("sintomas");
    const resultado = $("resultado");
    const btn = $("btnDiagnosticar");
    const btnExemplo = $("btnExemplo");
    const btnLimpar = $("btnLimpar");
    const statusDot = $("statusDot");
    const statusText = $("statusText");

    function setStatus(type, text){
      statusDot.className = "dot";
      if(type === "ok") statusDot.classList.add("ok");
      if(type === "err") statusDot.classList.add("err");
      if(type === "busy") statusDot.classList.add("busy");
      statusText.textContent = text;
    }

    function normalizeSymptoms(raw){
      return raw.split(/[,;\n]/g).map(s => s.trim()).filter(Boolean).join(",");
    }

    apiBase.addEventListener("input", () => {
      apiBadge.textContent = apiBase.value.trim() || "(vazio)";
    });

    btnExemplo.addEventListener("click", () => {
      sintomas.value = "febre, tosse, dor de garganta, cansaço";
      sintomas.focus();
    });

    btnLimpar.addEventListener("click", () => {
      sintomas.value = "";
      resultado.textContent = "—";
      setStatus("", "Pronto.");
    });

    btn.addEventListener("click", async () => {
      const base = apiBase.value.trim().replace(/\/+$/,"");
      const s = normalizeSymptoms(sintomas.value);

      if(!base){ setStatus("err","Informe a URL da API."); return; }
      if(!s){ setStatus("err","Informe pelo menos um sintoma."); return; }

      const urls = [
        `${base}/sintomas/predict?sintomas=${encodeURIComponent(s)}`,
        `${base}/sintomas/predict/?sintomas=${encodeURIComponent(s)}`
      ];

      btn.disabled = true;
      resultado.textContent = "Consultando a API...";
      setStatus("busy","Processando...");

      try{
        let res;
        for(const u of urls){
          try{
            res = await fetch(u);
            if(res.ok) break;
          }catch{}
        }

        if(!res || !res.ok){
          throw new Error("Falha ao acessar a API.");
        }

        const data = await res.json();

        if (data.top2 && Array.isArray(data.top2)) {
          const linhas = data.top2.map((it, i) =>
            `${i+1}) ${it.doenca} — ${it.prob_percent}%`
          ).join("\n");

          resultado.textContent =
            `Diagnóstico provável: ${data.diagnostico_provavel}\n\nTop 2 hipóteses:\n${linhas}`;
        } else {
          resultado.textContent = JSON.stringify(data, null, 2);
        }

        setStatus("ok","Concluído.");
      }catch(err){
        resultado.textContent = "Erro ao consultar a API.\n\n" + err.message;
        setStatus("err","Falha na requisição.");
      }finally{
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
